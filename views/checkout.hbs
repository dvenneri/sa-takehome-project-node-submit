<div class="row justify-content-md-center">
  <div class="col-6">
    <div class="text-center mt-40">
      <h1>
        Checkout â€” Stripe Press
      </h1>
      {{#if error}}
        <p class="text-danger">{{error}}</p>
      {{else}}
        <h5 class="text-secondary">
          {{title}}
        </h5>
        <hr class="mt-40">
        <div class="mt-20 text-info">
          Total due: ${{displayAmount}}
        </div>
      {{/if}}
    </div>

    {{#unless error}}
      <div class="card box-shadow mt-40">
        <div class="card-body">
          <form id="payment-form">
            <div id="payment-element" class="mt-20">
              <!-- Stripe Payment Element will be injected here -->
            </div>

            <div class="mt-20">
              <button id="submit" type="submit" class="btn btn-lg btn-block btn-primary">
                Pay ${{displayAmount}}
              </button>
            </div>

            <div id="payment-message" class="mt-20 text-danger"></div>
          </form>
        </div>
      </div>
    {{/unless}}
  </div>
</div>

<!-- Frontend initialises Stripe.js with publishable key and handles payment submission -->
<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe('{{publishableKey}}');
  const item = '{{item}}';
  const amount = {{amount}}; // cents

  let elements;

  // 1. Create a PaymentIntent and mount the Payment Element
  async function initialize() {
    const res = await fetch('/create-payment-intent', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ item })
    });

    const data = await res.json();
// Set up Stripe.js and Elements to use in checkout form
    elements = stripe.elements({ clientSecret: data.clientSecret });
    const paymentElement = elements.create('payment');
    paymentElement.mount('#payment-element');
  }

  initialize();

  // Confirm the payment with the Payment Element
  const form = document.getElementById('payment-form');
form.addEventListener('submit', async (event) => {
  event.preventDefault();
// Confirm the payment with the Payment Element
  const { error } = await stripe.confirmPayment({
    elements,
    confirmParams: {
      return_url: `${window.location.origin}/success`
    }
  });

  if (error) {
    document.getElementById('payment-message').textContent = error.message;
  }
});
</script>